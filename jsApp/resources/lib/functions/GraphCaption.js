metExploreD3.GraphCaption={refreshStyleOfReaction:function(){var a=metExploreD3.getReactionStyle();var b=Math.max(a.getWidth(),a.getHeight());var c=15/b;d3.select("#viz").select("#D3viz").select(".reactionCaption").attr("x",15/2-a.getWidth()*c/2).attr("y",15+15/2-a.getHeight()*c/2).attr("width",a.getWidth()*c).attr("height",a.getHeight()*c).attr("rx",a.getRX()*c).attr("ry",a.getRY()*c).attr("fill","white").attr("transform","translate(15,95)").style("stroke",a.getStrokeColor()).style("stroke-width",2)},refreshStyleOfMetabolite:function(){var b=metExploreD3.getMetaboliteStyle();var c=Math.max(b.getWidth(),b.getHeight());var a=15/c;d3.select("#viz").select("#D3viz").select(".metaboliteCaption").attr("x",15/2-b.getWidth()*a/2).attr("y",15+15/2-b.getHeight()*a/2).attr("width",b.getWidth()*a).attr("height",b.getHeight()*a).attr("rx",b.getRX()*a).attr("ry",b.getRY()*a).attr("fill","white").style("stroke","black").style("stroke-width",2).attr("transform","translate(15,130)")},drawCaption:function(){d3.select("#viz").select("#D3viz").select("#captionComparment").remove();d3.select("#viz").select("#D3viz").select("#captionPathway").remove();d3.select("#viz").select("#D3viz").select(".logoViz").remove();var A=metExploreD3.getReactionStyle();var F=Math.max(A.getWidth(),A.getHeight());var o=15/F;var D=metExploreD3.getMetaboliteStyle();var w=Math.max(D.getWidth(),D.getHeight());var m=15/w;var q=15/2-A.getWidth()*o/2;var p=15;var E=20+15/2-A.getWidth()*o/2;var B=15;var C=metExploreD3.getLinkStyle();var z=Math.sqrt(Math.pow(E-q,2)+Math.pow(B-p,2));var g=(E-q);var f=(B-p);var s=g/Math.abs(g);var r=f/Math.abs(f);var v=(Math.abs(z)*10/2)/Math.abs(g);var e=(Math.abs(z)*10/2)/Math.abs(f);var n=(v<e)?rT=v:rt=e;var i=5;var t=q+g*((z-n)/z);var c=p+f*((z-n)/z);var i=5;var u=q+g*((z-n-i)/z);var l=p+f*((z-n-i)/z);var h=q+g*((z-n-i-i)/z);var k=p+f*((z-n-i-i)/z);var y=u+f*(3/z);var b=l-g*(3/z);var x=u-f*(3/z);var a=l+g*(3/z);var j="M"+q+","+p+"L"+h+","+k+"L"+y+","+b+"L"+x+","+a+"L"+t+","+c+"L"+y+","+b+"L"+x+","+a+"L"+h+","+k+"Z";d3.select("#viz").select("#D3viz").append("svg:path").attr("class",String).attr("d",j).attr("class","linkCaptionRev").attr("fill-rule","evenodd").attr("fill","white").style("stroke",C.getStrokeColor()).style("stroke-width",1.5).style("stroke-linejoin","bevel").attr("transform","translate(15,65)");d3.select("#viz").select("#D3viz").append("svg:text").text("Reversible link").attr("x",20).attr("y",15).attr("transform","translate(30,70)");C=metExploreD3.getLinkStyle();var z=Math.sqrt(Math.pow(E-q,2)+Math.pow(B-p,2));var g=(E-q);var f=(B-p);var s=g/Math.abs(g);var r=f/Math.abs(f);var v=(Math.abs(z)*10/2)/Math.abs(g);var e=(Math.abs(z)*10/2)/Math.abs(f);var n=(v<e)?rT=v:rt=e;var t=q+g*((z-n)/z);var c=p+f*((z-n)/z);var i=5;var u=q+g*((z-n-i)/z);var l=p+f*((z-n-i)/z);var y=u+f*(3/z);var b=l-g*(3/z);var x=u-f*(3/z);var a=l+g*(3/z);j="M"+q+","+p+"L"+u+","+l+"L"+y+","+b+"L"+t+","+c+"L"+x+","+a+"L"+u+","+l+"Z";d3.select("#viz").select("#D3viz").append("svg:path").attr("class",String).attr("d",j).attr("class","linkCaptionRev").attr("fill-rule","evenodd").attr("fill","white").style("stroke",C.getStrokeColor()).style("stroke-width",1.5).style("stroke-linejoin","bevel").attr("transform","translate(15,40)");d3.select("#viz").select("#D3viz").append("svg:text").text("Link").attr("x",20).attr("y",15).attr("transform","translate(30,45)");d3.select("#viz").select("#D3viz").append("svg:text").attr("id","metexplore").text("MetExploreViz").attr("x",$("#viz").width()-130).attr("y",$("#viz").height()-10);d3.select("#viz").select("#D3viz").append("svg:g").attr("class","logoViz").attr("id","logoViz").append("image").attr("xlink:href","resources/icons/metExploreViz_Logo.svg").attr("width","50").attr("height","50").attr("x",$("#viz").width()-110).attr("y",$("#viz").height()-75);d3.select("#viz").select("#D3viz").append("svg:rect").attr("class","reactionCaption").attr("x",15/2-A.getWidth()*o/2).attr("y",15).attr("width",A.getWidth()*o).attr("height",A.getHeight()*o).attr("rx",A.getRX()*o).attr("ry",A.getRY()*o).attr("fill","white").attr("transform","translate(15,95)").style("stroke",A.getStrokeColor()).style("stroke-width",2);d3.select("#viz").select("#D3viz").append("svg:text").text("Reaction").attr("x",20).attr("y",15).attr("transform","translate(30,105)");d3.select("#viz").select("#D3viz").append("svg:rect").attr("class","metaboliteCaption").attr("x",15/2-D.getWidth()*m/2).attr("y",15+15/2-D.getHeight()*m/2).attr("width",D.getWidth()*m).attr("height",D.getHeight()*m).attr("rx",D.getRX()*m).attr("ry",D.getRY()*m).attr("fill","white").style("stroke","black").style("stroke-width",2).attr("transform","translate(15,130)");d3.select("#viz").select("#D3viz").append("svg:text").text("Metabolites").attr("x",20).attr("y",15).attr("transform","translate(30,140)");metExploreD3.GraphCaption.colorPathwayLegend(175);metExploreD3.GraphCaption.colorMetaboliteLegend(175);d3.select("#viz").select("#D3viz").select("#captionComparment").classed("hide",true);d3.select("#viz").select("#D3viz").select("#captionPathway").classed("hide",true);metExploreD3.GraphCaption.majCaption()},majCaption:function(){var c=_metExploreViz.getGeneralStyle();var a=c.isDisplayedConvexhulls();d3.select("#viz").select("#D3viz").selectAll(".iconHideComponent").classed("hide",!a);var b=c.isDisplayedCaption();if(b=="Pathways"){d3.select("#viz").select("#D3viz").selectAll("path.convexhull").classed("hide",function(e){var d=_metExploreViz.getSessionById("viz").getD3Data().getPathwayByName(e.key);if(d){return d.hidden()}return true});d3.select("#viz").select("#D3viz").select("#captionComparment").classed("hide",true);d3.select("#viz").select("#D3viz").select("#captionPathway").classed("hide",false)}else{d3.select("#viz").select("#D3viz").selectAll("path.convexhull").classed("hide",function(e){var d=_metExploreViz.getSessionById("viz").getD3Data().getCompartmentByName(e.key);return d.hidden()});d3.select("#viz").select("#D3viz").select("#captionComparment").classed("hide",false);d3.select("#viz").select("#D3viz").select("#captionPathway").classed("hide",true)}},colorMetaboliteLegend:function(k){var e=k;var h=d3.select("#viz").select("#D3viz").append("svg").attr("id","captionComparment").attr("y",k).append("svg:g").attr("x1",0).attr("y1",0).attr("x2",15).attr("y2",0).append("foreignObject").classed("foreignObjectCaptionContainer",true).attr("height",($("#viz").height()-e-15)+"px").attr("width","200px").append("xhtml:div").classed("captionContainer",true);var n=h.append("svg");var r=n.append("svg:g").attr("x1",0).attr("y1",0).attr("x2",15).attr("y2",0);var a=_metExploreViz.getSessionById("viz").getD3Data();var t=metExploreD3.getReactionStyle();var w=Math.max(t.getWidth(),t.getHeight());var j=20/w;var u=metExploreD3.getMetaboliteStyle();var q=Math.max(u.getWidth(),u.getHeight());var d=20/q;metExploreD3.sortCompartmentInBiosource();var b=metExploreD3.getCompartmentInBiosourceLength();if(b==undefined){b=0}center=128;width=127;frequency=Math.PI*2*0.95/b;var x=0;x+=20;r.append("svg:text").text("Compartments :").attr("x",0).attr("y",0).attr("transform","translate(15,"+x+")");x+=20;var l=0;for(var o=0;o<b;o++){red=Math.sin(frequency*o+2+b)*width+center;green=Math.sin(frequency*o+0+b)*width+center;blue=Math.sin(frequency*o+4+b)*width+center;var c=metExploreD3.getCompartmentInBiosourceSet()[o];c.setColor(metExploreD3.GraphUtils.RGB2Color(red,green,blue));var p=r.append("svg:g").attr("id","compartment"+c.getId());var v="captionimage"+c.getId();p.append("svg:line").attr("class","metabolite").attr("class",v).attr("x1",0).attr("y1",0).attr("x2",15).attr("y2",0).style("stroke",c.getColor()).style("stroke-width",2).attr("transform","translate(38,"+x+")").attr("opacity",function(){if(c.hidden()){return 0.3}else{return 1}});x+=10;var m="captiontext"+c.getId();p.append("svg:text").html(c.getName()).attr("class",m).attr("id","compartment"+c.getId()).attr("x",30).attr("y",-6).attr("transform","translate(30,"+x+")").attr("opacity",function(){if(c.hidden()){return 0.3}else{return 1}});m="."+m;var s=p.select(m).node();var g=s.getComputedTextLength();var f=p.append("svg").attr("opacity","0.8").attr("viewBox",function(i){+" "+10}).attr("width",40).attr("height",20).attr("rx",10).attr("ry",10).attr("preserveAspectRatio","xMinYMin").attr("x",3).attr("y",x-20).attr("id","compartment"+c.getId()).attr("class","hideComponent"+c.getId()).classed("hide",false).attr("transform","translate(3,"+x+")").on("click",function(){var i=a.getCompartmentById(this.id.split("compartment",2)[1]);i.setHidden(!i.hidden());if(i.hidden()){r.select(".captiontext"+i.getId()).attr("opacity",0.5);r.select(".captionimage"+i.getId()).attr("opacity",0.3)}else{r.select(".captiontext"+i.getId()).attr("opacity",1);r.select(".captionimage"+i.getId()).attr("opacity",1)}d3.select("#viz").select("#D3viz").selectAll("path.convexhull").classed("hide",function(z){var y=_metExploreViz.getSessionById("viz").getD3Data().getCompartmentByName(z.key);return y.hidden()});d3.select(this).select(".iconHideComponent").attr("xlink:href",function(y){if(i.hidden()){return"resources/icons/square.jpg"}else{return"resources/icons/check-square.svg"}})});f.append("svg:rect").attr("class","backgroundHideComponent").attr("height",20).attr("width",40).attr("rx",5).attr("ry",5).attr("opacity","0");f.append("image").attr("class","iconHideComponent").attr("y",0).attr("x",0).attr("width","100%").attr("height","100%").attr("xlink:href",function(i){if(c.hidden()){return"resources/icons/square.jpg"}else{return"resources/icons/check-square.svg"}});x+=10;if(l<$("#compartment"+c.getId()).width()){l=$("#compartment"+c.getId()).width()}}var e=d3.select("#viz").select("#D3viz").select("#captionComparment").attr("y");d3.select("#viz").select("#D3viz").selectAll(".foreignObjectCaptionContainer").selectAll(".captionContainer").style("height",($("#viz").height()-e-15)+"px");n.style("height",(20*(b+2))+"px").style("width",(l+60)+"px")},colorPathwayLegend:function(k){var u=metExploreD3.getPathwaysSet();var p=[];var b=_metExploreViz.getSessionById("viz").getD3Data();u.forEach(function(i){p.push({key:i})});var c=metExploreD3.getPathwaysLength();if(c==undefined){c=0}center=128;width=127;frequency=Math.PI*2*0.95/c;var l=0;for(var q=0;q<c;q++){red=Math.sin(frequency*q+2+c)*width+center;green=Math.sin(frequency*q+0+c)*width+center;blue=Math.sin(frequency*q+4+c)*width+center;var A=p[q].key;A.setColor(metExploreD3.GraphUtils.RGB2Color(red,green,blue))}var e=k;var h=d3.select("#viz").select("#D3viz").append("svg").attr("id","captionPathway").attr("y",k).append("svg:g").attr("x1",0).attr("y1",0).attr("x2",15).attr("y2",0).append("foreignObject").classed("foreignObjectCaptionContainer",true).attr("height",($("#viz").height()-e-15)+"px").attr("width","200px").append("xhtml:div").classed("captionContainer",true);var o=h.append("svg");var s=o.append("svg:g").attr("x1",0).attr("y1",0).attr("x2",15).attr("y2",0);var w=metExploreD3.getReactionStyle();var C=Math.max(w.getWidth(),w.getHeight());var j=20/C;var x=metExploreD3.getMetaboliteStyle();var r=Math.max(x.getWidth(),x.getHeight());var d=20/r;var a=_metExploreViz.getSessionById("viz");p.sort(function(y,i){if(y.key<i.key){return -1}if(y.key>i.key){return 1}return 0});var c=p.length;if(c==undefined){c=0}center=128;width=127;frequency=Math.PI*2*0.95/c;var B=0;B+=20;s.append("svg:text").text("Pathways :").attr("x",0).attr("y",0).attr("transform","translate(15,"+B+")");B+=20;var l=0;for(var q=0;q<c;q++){red=Math.sin(frequency*q+2+c)*width+center;green=Math.sin(frequency*q+0+c)*width+center;blue=Math.sin(frequency*q+4+c)*width+center;var A=p[q].key;var m=s.append("svg:g").attr("id","pathway"+A.getId());var z="captionimage"+A.getId();m.append("svg:line").attr("class","metabolite").attr("class",z).attr("x1",0).attr("y1",0).attr("x2",15).attr("y2",0).style("stroke",A.getColor()).style("stroke-width",2).attr("transform","translate(38,"+B+")").attr("opacity",function(){if(A.hidden()){return 0.3}else{return 1}});B+=10;var n="captiontext"+A.getId();m.append("svg:text").html(A.getName()).attr("class",n).attr("id","pathway"+A.getId()).attr("x",30).attr("y",-6).attr("transform","translate(30,"+B+")").attr("opacity",function(){if(A.hidden()){return 0.3}else{return 1}});n="."+n;var t=m.select(n).node();var g=t.getComputedTextLength();var v=50+g;var f=m.append("svg").attr("opacity","0.8").attr("viewBox",function(i){+" "+10}).attr("width",40).attr("height",20).attr("rx",10).attr("ry",10).attr("preserveAspectRatio","xMinYMin").attr("x",3).attr("y",B-20).attr("id","pathway"+A.getId()).attr("class","hideComponent"+A.getId()).classed("hide",false).attr("transform","translate(3,"+B+")").on("click",function(){var i=b.getPathwayById(this.id.split("pathway",2)[1]);i.setHidden(!i.hidden());if(i.hidden()){s.select(".captiontext"+i.getId()).attr("opacity",0.5);s.select(".captionimage"+i.getId()).attr("opacity",0.3)}else{s.select(".captiontext"+i.getId()).attr("opacity",1);s.select(".captionimage"+i.getId()).attr("opacity",1)}d3.select("#viz").select("#D3viz").selectAll("path.convexhull").classed("hide",function(D){var y=_metExploreViz.getSessionById("viz").getD3Data().getPathwayByName(D.key);return y.hidden()});d3.select(this).select(".iconHideComponent").attr("xlink:href",function(y){if(i.hidden()){return"resources/icons/square.jpg"}else{return"resources/icons/check-square.svg"}})});f.append("svg:rect").attr("class","backgroundHideComponent").attr("height",20).attr("width",40).attr("rx",5).attr("ry",5).attr("opacity","0");f.append("image").attr("class","iconHideComponent").attr("y",0).attr("x",0).attr("width","100%").attr("height","100%").attr("xlink:href",function(i){if(A.hidden()){return"resources/icons/square.jpg"}else{return"resources/icons/check-square.svg"}});B+=10;if(l<$("#pathway"+A.getId()).width()){l=$("#pathway"+A.getId()).width()}}var e=d3.select("#viz").select("#D3viz").select("#captionPathway").attr("y");d3.select("#viz").select("#D3viz").selectAll(".foreignObjectCaptionContainer").selectAll(".captionContainer").style("height",($("#viz").height()-e-15)+"px");o.style("height",(20*(c+2))+"px").style("width",(l+60)+"px")}};